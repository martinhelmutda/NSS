{% extends 'base.html' %}
{% load staticfiles %}
{% block title %}Mensajes{% endblock %}
{% block body_block %}
<style>
  .avatar  { width:50px; height:50px; float:left; margin-right:10px; }
</style>
<main role="main">
  <div class="container">
    <div class="ui container segment">
      <!-- Hilos de conversación -->
      <!-- Recorremos los Threads y sólo mostramos los que tienen como mínimo 1 mensaje -->
      <h1>Mensajes</h1>
      {{ thread.users }}
      {% for thread in request.user.threads.all %}
      {% if thread.messages.all|length > 0 %}
      <div class="mb-3">
        <!-- Recorremos los miembros del hilo menos el propio request.user -->
        {% for user in thread.users.all %}
        {% if user != request.user %}
        <!-- Mostramos el avatar del miembro -->
        {% if user.profile.avatar %}
        <img src="{{user.profile.avatar.url}}" class="avatar">
        {% else %}
        <img src="{% static 'registration/img/no-avatar.jpg' %}" class="avatar">
        {% endif %}
        <!-- Mostramos la información del miembro -->
        <div>
          <a href="{% url 'messages_app:detail' thread.pk %}">{{user}}</a><br>
          <small><i>Hace {{thread.messages.last.created|timesince}}</i></small>
        </div>
        {% endif %}
        {% endfor %}
      </div>
      {% endif %}
      {% endfor %}

      <!-- Hilos de conversación -->
      <div class="col-md-8">
        <p><i>Selecciona un hilo de conversación de tu panel izquierdo.</i></p>
      </div>
    </div>
  </div>

</main>
{% endblock %}
